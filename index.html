<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>×‘×™×•×¤×™×“×‘×§ ×ª×•×“×¢×ª×™ - ×¨×™×¤×•×™ ×’×•×£ ×•× ×¤×© âœ¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #fce4ec;
            min-height: 100vh;
            direction: rtl;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 20px 0;
        }

        h1 {
            color: #F7A8B8;
            font-size: 2.2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 10px;
        }

        .subtitle {
            color: #7cb69d;
            font-size: 1.1em;
        }

        .upload-section {
            background: white;
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(247, 168, 184, 0.15);
            text-align: center;
            margin-bottom: 20px;
        }

        .upload-area {
            border: 3px dashed #F7A8B8;
            border-radius: 20px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s;
            background: #fef7fa;
        }

        .upload-area:hover {
            border-color: #f48fb1;
            background: #fff0f5;
        }

        .upload-area.has-image {
            border-style: solid;
            border-color: #7cb69d;
        }

        .upload-icon {
            font-size: 50px;
            margin-bottom: 10px;
        }

        .upload-text {
            color: #888;
            font-size: 1em;
        }

        #fileInput {
            display: none;
        }

        .mode-selection {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .mode-btn {
            padding: 18px 25px;
            font-size: 1em;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
        }

        .mode-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .heart-btn {
            background: #F7A8B8;
            color: #c2185b;
            box-shadow: 0 5px 20px rgba(247, 168, 184, 0.4);
        }

        .heart-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            background: #f48fb1;
        }

        .breath-btn {
            background: #b2dfdb;
            color: #00695c;
            box-shadow: 0 5px 20px rgba(178, 223, 219, 0.4);
        }

        .breath-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            background: #80cbc4;
        }

        .muscle-btn {
            background: #ffe0b2;
            color: #e65100;
            box-shadow: 0 5px 20px rgba(255, 224, 178, 0.4);
        }

        .muscle-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            background: #ffcc80;
        }

        .skin-btn {
            background: #c5cae9;
            color: #303f9f;
            box-shadow: 0 5px 20px rgba(197, 202, 233, 0.4);
        }

        .skin-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            background: #9fa8da;
        }

        .save-btn {
            background: #a5d6a7;
            color: #2e7d32;
            box-shadow: 0 5px 20px rgba(165, 214, 167, 0.4);
        }

        .save-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            background: #81c784;
        }

        .simulation-area {
            background: white;
            border-radius: 25px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(124, 182, 157, 0.2);
            position: relative;
        }

        .canvas-container {
            position: relative;
            width: 100%;
            height: 600px;
            background: #fefefe;
            border-radius: 15px;
            overflow: hidden;
            touch-action: none;
        }

        #simulationCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            pointer-events: none;
        }

        .draggable-image {
            position: absolute;
            max-width: 160px;
            max-height: 220px;
            border-radius: 15px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.3);
            cursor: move;
            z-index: 10;
            transition: transform 0.3s, box-shadow 0.3s, filter 0.5s;
            touch-action: none;
        }

        /* Biofeedback Monitor */
        .bio-monitor {
            position: absolute;
            width: 180px;
            height: 240px;
            z-index: 8;
            cursor: move;
            touch-action: none;
        }

        .monitor-body {
            width: 100%;
            height: 200px;
            background: #37474f;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            position: relative;
            border: 3px solid #546e7a;
        }

        .monitor-screen {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 100px;
            background: #1a1a2e;
            border-radius: 8px;
            border: 2px solid #455a64;
            overflow: hidden;
        }

        .vital-display {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .vital-line {
            fill: none;
            stroke-width: 2;
            animation: vitalMove 2s linear infinite;
        }

        .vital-line.heart {
            stroke: #ff5252;
        }

        .vital-line.breath {
            stroke: #69f0ae;
        }

        .vital-line.muscle {
            stroke: #ffab40;
        }

        .vital-line.skin {
            stroke: #448aff;
        }

        @keyframes vitalMove {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100px); }
        }

        .monitor-readings {
            position: absolute;
            top: 125px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            width: 90%;
        }

        .reading-box {
            background: #263238;
            border-radius: 5px;
            padding: 5px 8px;
            text-align: center;
            min-width: 60px;
        }

        .reading-label {
            font-size: 8px;
            color: #90a4ae;
        }

        .reading-value {
            font-size: 14px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .reading-value.heart { color: #ff5252; }
        .reading-value.breath { color: #69f0ae; }
        .reading-value.muscle { color: #ffab40; }
        .reading-value.skin { color: #448aff; }

        .monitor-label {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 9px;
            color: #90a4ae;
            font-weight: bold;
        }

        .monitor-base {
            width: 100%;
            height: 30px;
            background: #455a64;
            border-radius: 0 0 15px 15px;
            margin-top: 10px;
        }

        /* Release Container */
        .release-container {
            position: absolute;
            width: 100px;
            height: 140px;
            z-index: 8;
            cursor: move;
            touch-action: none;
        }

        .release-jar {
            width: 100%;
            height: 110px;
            background: rgba(255,255,255,0.95);
            border: 3px solid #78909c;
            border-radius: 10px 10px 30px 30px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .release-jar::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            width: 15px;
            height: 50px;
            background: rgba(255,255,255,0.5);
            border-radius: 5px;
            transform: skewX(-5deg);
        }

        .release-level {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            height: 0;
            transition: height 0.5s ease-out;
            border-radius: 0 0 27px 27px;
        }

        .release-level.stress {
            background: #ef5350;
        }

        .release-level.tension {
            background: #ff7043;
        }

        .release-level.anxiety {
            background: #7e57c2;
        }

        .release-lid {
            width: 110%;
            height: 20px;
            background: #607d8b;
            border-radius: 5px;
            margin-left: -5%;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .release-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: #78909c;
            font-weight: bold;
            white-space: nowrap;
        }

        /* Calm Infusion */
        .calm-infusion {
            position: absolute;
            width: 100px;
            height: 160px;
            z-index: 8;
            cursor: move;
            touch-action: none;
        }

        .calm-bag {
            width: 70px;
            height: 90px;
            background: rgba(178, 223, 219, 0.9);
            border-radius: 10px 10px 25px 25px;
            margin: 0 auto;
            position: relative;
            box-shadow: 0 5px 20px rgba(178, 223, 219, 0.5);
            border: 2px solid #4db6ac;
        }

        .calm-bag::before {
            content: 'ğŸŒ¿';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 28px;
            animation: calmPulse 2s ease-in-out infinite;
        }

        @keyframes calmPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.8; }
        }

        .calm-stand {
            width: 15px;
            height: 50px;
            background: #9e9e9e;
            margin: 0 auto;
            border-radius: 3px;
        }

        .calm-base {
            width: 50px;
            height: 12px;
            background: #757575;
            margin: 0 auto;
            border-radius: 3px;
        }

        .calm-label {
            text-align: center;
            font-size: 10px;
            color: #00897b;
            font-weight: bold;
            margin-top: 5px;
        }

        /* Sensor Handles */
        .sensor-handle {
            position: absolute;
            width: 38px;
            height: 38px;
            border-radius: 50%;
            cursor: grab;
            z-index: 20;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            transition: transform 0.1s;
            touch-action: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            animation: sensorPulse 2s ease-in-out infinite;
        }

        @keyframes sensorPulse {
            0%, 100% { box-shadow: 0 4px 20px rgba(0,0,0,0.4); }
            50% { box-shadow: 0 4px 25px rgba(255,255,255,0.6), 0 0 15px rgba(255,255,255,0.4); }
        }

        .sensor-handle::after {
            content: '';
            width: 12px;
            height: 12px;
            background: rgba(255,255,255,0.5);
            border-radius: 50%;
            position: absolute;
            top: 6px;
            left: 6px;
        }

        .sensor-handle:hover {
            transform: scale(1.2);
            animation: none;
            box-shadow: 0 6px 25px rgba(0,0,0,0.5);
        }

        .sensor-handle.dragging {
            cursor: grabbing;
            transform: scale(1.3);
            animation: none;
            box-shadow: 0 8px 30px rgba(0,0,0,0.6);
        }

        .sensor-handle.heart-sensor {
            background: #ff5252;
            border: 3px solid #ffcdd2;
        }

        .sensor-handle.breath-sensor {
            background: #26a69a;
            border: 3px solid #b2dfdb;
        }

        .sensor-handle.muscle-sensor {
            background: #ff9800;
            border: 3px solid #ffe0b2;
        }

        .sensor-handle.skin-sensor {
            background: #5c6bc0;
            border: 3px solid #c5cae9;
        }

        .sensor-handle.release-sensor {
            background: #78909c;
            border: 3px solid #cfd8dc;
        }

        .sensor-handle.calm-sensor {
            background: #4db6ac;
            border: 3px solid #b2dfdb;
        }

        .mode-indicator {
            text-align: center;
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            margin: 0 auto 15px;
            font-weight: bold;
            font-size: 1.1em;
        }

        .mode-indicator.heart { background: #ffcdd2; color: #c62828; }
        .mode-indicator.breath { background: #b2dfdb; color: #00695c; }
        .mode-indicator.muscle { background: #ffe0b2; color: #e65100; }
        .mode-indicator.skin { background: #c5cae9; color: #303f9f; }

        .instructions-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 15px 0;
            padding: 12px;
            background: #fff8e1;
            border-radius: 15px;
            font-size: 0.95em;
            color: #666;
        }

        .instructions-bar span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .start-btn {
            display: none;
            margin: 15px auto;
            padding: 15px 40px;
            background: #81c784;
            color: #1b5e20;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-family: inherit;
            font-size: 1.2em;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(129, 199, 132, 0.4);
        }

        .start-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            background: #66bb6a;
        }

        .start-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .progress-section {
            margin-top: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: inset 0 3px 8px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            border-radius: 15px;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.95em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .progress-fill.heart { background: #ef5350; }
        .progress-fill.breath { background: #26a69a; }
        .progress-fill.muscle { background: #ff9800; }
        .progress-fill.skin { background: #5c6bc0; }

        .affirmation {
            text-align: center;
            font-size: 1.25em;
            color: #00897b;
            margin-top: 20px;
            font-weight: 500;
            min-height: 60px;
            line-height: 1.5;
            padding: 15px;
            background: rgba(255,255,255,0.7);
            border-radius: 15px;
        }

        .reset-btn {
            display: block;
            margin: 20px auto 0;
            padding: 12px 30px;
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 30px;
            cursor: pointer;
            font-family: inherit;
            font-size: 1em;
            color: #666;
            transition: all 0.3s;
        }

        .reset-btn:hover {
            background: #eeeeee;
            border-color: #bdbdbd;
        }

        .hidden {
            display: none !important;
        }

        /* Gallery */
        .saved-gallery {
            margin-top: 25px;
            padding: 25px;
            background: white;
            border-radius: 25px;
            box-shadow: 0 10px 40px rgba(247, 168, 184, 0.1);
        }

        .gallery-title {
            text-align: center;
            color: #F7A8B8;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .gallery-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        .gallery-item {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 25px rgba(0,0,0,0.15);
            transition: transform 0.3s;
        }

        .gallery-item:hover {
            transform: scale(1.05);
        }

        .gallery-item img {
            max-width: 140px;
            max-height: 180px;
            display: block;
        }

        .delete-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 30px;
            height: 30px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
            transition: all 0.2s;
        }

        .delete-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }

        .gallery-item-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 8px 5px 5px;
            font-size: 10px;
            text-align: center;
        }

        footer {
            text-align: center;
            padding: 25px;
            color: #999;
            font-size: 0.95em;
        }

        footer a {
            color: #F7A8B8;
            text-decoration: none;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container { padding: 10px; }
            h1 { font-size: 1.6em; }
            .subtitle { font-size: 0.95em; }
            .upload-section { padding: 15px; }
            .upload-area { padding: 20px; }

            .mode-selection {
                flex-direction: column;
                align-items: center;
            }

            .mode-btn {
                width: 100%;
                max-width: 250px;
                justify-content: center;
                font-size: 0.95em;
                padding: 14px 20px;
            }

            .canvas-container { height: 500px; }
            .draggable-image { max-width: 100px; max-height: 150px; }
            .bio-monitor { transform: scale(0.7); }
            .release-container { transform: scale(0.75); }
            .calm-infusion { transform: scale(0.7); }
            .sensor-handle { width: 24px; height: 24px; }

            .instructions-bar {
                flex-direction: column;
                gap: 8px;
                font-size: 0.85em;
            }

            .affirmation { font-size: 1.1em; }
            .gallery-item img { max-width: 100px; max-height: 130px; }
        }

        @media (max-width: 480px) {
            h1 { font-size: 1.4em; }
            .canvas-container { height: 420px; }
            .draggable-image { max-width: 85px; max-height: 120px; }
            .bio-monitor { transform: scale(0.55); }
            .release-container { transform: scale(0.6); }
            .calm-infusion { transform: scale(0.55); }
            .sensor-handle { width: 20px; height: 20px; }
            .affirmation { font-size: 1em; padding: 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ’— ×‘×™×•×¤×™×“×‘×§ ×ª×•×“×¢×ª×™ âœ¨</h1>
            <p class="subtitle">××™×–×•×Ÿ ×”×’×•×£ ×•×”× ×¤×© - ×©×—×¨×•×¨ ××ª×— ×•×™×¦×™×¨×ª ×©×œ×•×•×”</p>
        </header>

        <div class="upload-section">
            <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">ğŸ“·</div>
                <p class="upload-text">×œ×—×¦×™ ×œ×”×¢×œ××ª ×”×ª××•× ×” ×©×œ×š</p>
            </div>
            <input type="file" id="fileInput" accept="image/*">
        </div>

        <div class="mode-selection">
            <button class="mode-btn heart-btn" id="heartBtn" disabled onclick="startHeartMode()">
                <span>â¤ï¸</span>
                <span>××™×–×•×Ÿ ×§×¦×‘ ×”×œ×‘</span>
            </button>
            <button class="mode-btn breath-btn" id="breathBtn" disabled onclick="startBreathMode()">
                <span>ğŸŒ¬ï¸</span>
                <span>×•×™×¡×•×ª × ×©×™××”</span>
            </button>
            <button class="mode-btn muscle-btn" id="muscleBtn" disabled onclick="startMuscleMode()">
                <span>ğŸ’ª</span>
                <span>×©×—×¨×•×¨ ××ª×— ×©×¨×™×¨×™×</span>
            </button>
            <button class="mode-btn skin-btn" id="skinBtn" disabled onclick="startSkinMode()">
                <span>âœ‹</span>
                <span>×ª×’×•×‘×ª ×¢×•×¨ ×•×¨×’×™×¢×”</span>
            </button>
            <button class="mode-btn save-btn" id="saveBtn" disabled onclick="saveImage()">
                <span>ğŸ’¾</span>
                <span>×©××™×¨×”</span>
            </button>
        </div>

        <div class="simulation-area">
            <div style="text-align: center;">
                <div class="mode-indicator hidden" id="modeIndicator">××¦×‘ ×¢×‘×•×“×”</div>
            </div>

            <div class="instructions-bar">
                <span>ğŸ”Œ ×’×¨×¨×™ ××ª ×”×—×™×™×©× ×™× ×•×—×‘×¨×™ ××•×ª× ×œ×’×•×£</span>
                <span>ğŸ“ ×”×–×–×™ ××ª ×”××›×©×™×¨×™×</span>
                <span>â–¶ï¸ ×œ×—×¦×™ "×”×ª×—×œ ×˜×™×¤×•×œ"</span>
            </div>

            <div class="canvas-container" id="canvasContainer">
                <svg id="simulationCanvas"></svg>

                <img class="draggable-image hidden" id="userImage" src="" alt="×ª××•× ×”">

                <!-- Biofeedback Monitor -->
                <div class="bio-monitor hidden" id="bioMonitor">
                    <div class="monitor-body">
                        <div class="monitor-screen">
                            <svg class="vital-display" viewBox="0 0 150 100">
                                <path class="vital-line heart" id="heartLine" d="M0,50 L10,50 L15,30 L20,70 L25,50 L35,50 L40,30 L45,70 L50,50 L60,50 L65,30 L70,70 L75,50 L85,50 L90,30 L95,70 L100,50 L110,50 L115,30 L120,70 L125,50 L150,50" />
                            </svg>
                        </div>
                        <div class="monitor-readings">
                            <div class="reading-box">
                                <div class="reading-label">×§×¦×‘ ×œ×‘</div>
                                <div class="reading-value heart" id="heartValue">72</div>
                            </div>
                            <div class="reading-box">
                                <div class="reading-label">× ×©×™××•×ª</div>
                                <div class="reading-value breath" id="breathValue">14</div>
                            </div>
                            <div class="reading-box">
                                <div class="reading-label">××ª×—</div>
                                <div class="reading-value muscle" id="muscleValue">45%</div>
                            </div>
                            <div class="reading-box">
                                <div class="reading-label">GSR</div>
                                <div class="reading-value skin" id="skinValue">3.2</div>
                            </div>
                        </div>
                        <div class="monitor-label">BIO-HEAL MONITOR</div>
                    </div>
                    <div class="monitor-base"></div>
                </div>

                <!-- Release Container -->
                <div class="release-container hidden" id="releaseContainer">
                    <div class="release-lid"></div>
                    <div class="release-jar">
                        <div class="release-level" id="releaseLevel"></div>
                    </div>
                    <div class="release-label">××™×›×œ ×©×—×¨×•×¨ ××ª×—×™×</div>
                </div>

                <!-- Calm Infusion -->
                <div class="calm-infusion hidden" id="calmInfusion">
                    <div class="calm-bag"></div>
                    <div class="calm-stand"></div>
                    <div class="calm-base"></div>
                    <div class="calm-label">×¢×™×¨×•×™ ×©×œ×•×•×” ×•×¨×•×’×¢</div>
                </div>
            </div>

            <button class="start-btn" id="startBtn" onclick="startSimulation()">
                â–¶ï¸ ×”×ª×—×œ ×˜×™×¤×•×œ
            </button>

            <div class="progress-section hidden" id="progressSection">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill">0%</div>
                </div>
            </div>

            <p class="affirmation hidden" id="affirmation"></p>

            <button class="reset-btn hidden" id="resetBtn" onclick="resetAll()">ğŸ”„ ×”×ª×—×œ×” ××—×“×©</button>
        </div>

        <div class="saved-gallery" id="savedGallery">
            <h3 class="gallery-title hidden" id="galleryTitle">ğŸ“¸ ×”×ª××•× ×•×ª ×”×××•×–× ×•×ª ×©×œ×™</h3>
            <div class="gallery-grid" id="galleryGrid"></div>
        </div>

        <footer>
            <p>ğŸ’— ×”×’×•×£ ×•×”× ×¤×© ×©×œ×š ×™×•×“×¢×™× ×œ×”×™×¨×¤× ğŸ’—</p>
            <p style="margin-top: 10px; font-size: 0.85em;">
                ×–×•×”×™ ××¤×œ×™×§×¦×™×” ×œ×¢×‘×•×“×” ×ª×•×“×¢×ª×™×ª ×•××™× ×” ××—×œ×™×¤×” ×˜×™×¤×•×œ ××§×¦×•×¢×™.<br>
                ×× ××ª ×‘××¦×•×§×”: <a href="tel:1800353300">1-800-353-300</a>
            </p>
        </footer>
    </div>

    <script>
        function resetAll() {
            if (confirm('×”×× ××ª ×‘×˜×•×—×” ×©×‘×¨×¦×•× ×š ×œ×”×ª×—×™×œ ××—×“×©?')) {
                clearInterval(animationInterval);
                isSimulating = false;
                clearSensorsAndWires();

                ['userImage', 'bioMonitor', 'releaseContainer', 'calmInfusion'].forEach(id => {
                    const el = document.getElementById(id);
                    el.classList.add('hidden');
                    el.style.transform = '';
                    el.style.filter = '';
                    el.style.boxShadow = '';
                });

                document.getElementById('modeIndicator').classList.add('hidden');
                document.getElementById('startBtn').style.display = 'none';
                document.getElementById('startBtn').disabled = false;
                document.getElementById('startBtn').textContent = 'â–¶ï¸ ×”×ª×—×œ ×˜×™×¤×•×œ';

                document.getElementById('progressSection').classList.add('hidden');
                document.getElementById('progressFill').style.width = '0%';
                document.getElementById('progressFill').textContent = '0%';

                document.getElementById('releaseLevel').style.height = '0';

                document.getElementById('affirmation').classList.add('hidden');
                document.getElementById('affirmation').textContent = '';
                document.getElementById('resetBtn').classList.add('hidden');
                document.getElementById('saveBtn').disabled = true;

                container.querySelectorAll('.particle').forEach(p => p.remove());

                currentMode = null;
                alert('×”××¤×œ×™×§×¦×™×” ××•×¤×¡×” ×‘×”×¦×œ×—×”!');
            }
        }

        let uploadedImage = null;
        let currentMode = null;
        let animationInterval = null;
        let isSimulating = false;
        let wires = [];
        let activeHandle = null;

        const heartAffirmations = [
            "×”×—×™×™×©× ×™× ××ª×—×‘×¨×™× ×œ×œ×‘ ×©×œ×š",
            "××•×“×“×™× ××ª ×§×¦×‘ ×”×œ×‘ ×”× ×•×›×—×™",
            "××–×”×™× ×“×¤×•×¡×™ ×œ×—×¥ ××˜×¨××•××•×ª ×™×œ×“×•×ª",
            "×”×œ×‘ ××©×—×¨×¨ ××ª ×”×¤×—×“ ××”×¦×¢×§×•×ª",
            "×”×œ×‘ ×××˜ ×•××ª×™×™×¦×‘",
            "×“×•×¤×§ ×©×œ×•×•×” ×–×•×¨× ×‘×’×•×¤×š",
            "×”×œ×‘ ×©×œ×š ×¤×•×¢× ×‘×¨×•×’×¢",
            "×›×œ ×¤×¢×™××” ××‘×™××” ×©×œ×•×",
            "××™×–×•×Ÿ ××•×©×œ× ×©×œ ×§×¦×‘ ×”×œ×‘",
            "ğŸ‰ ×”×œ×‘ ×©×œ×š ×¤×•×¢× ×‘×”×¨××•× ×™×” ××•×©×œ××ª! ğŸ‰"
        ];

        const breathAffirmations = [
            "××—×‘×¨×™× ×—×™×™×©× ×™ × ×©×™××”",
            "××•×“×“×™× ××ª ×“×¤×•×¡ ×”× ×©×™××”",
            "××–×”×™× × ×©×™××” ×¢×¦×•×¨×” ××¤×—×“",
            "××©×—×¨×¨×™× ××ª ×”× ×©×™××” ×©× ×¢×¦×¨×” ×‘×™×œ×“×•×ª",
            "×©××¤×™ ×¢××•×§... × ×©×¤×™ ×œ××˜...",
            "×”× ×©×™××” × ×”×™×™×ª ×¢××•×§×” ×•××™×˜×™×ª",
            "×—××¦×Ÿ ×˜×”×•×¨ ×××œ× ××ª ×”×¨×™××•×ª",
            "×›×œ × ×©×™××” ××‘×™××” ×¨×•×’×¢",
            "× ×©×™××” ××•×©×œ××ª ×•×××•×–× ×ª",
            "ğŸ‰ ×”× ×©×™××” ×©×œ×š ×–×•×¨××ª ×‘×©×œ×•×•×”! ğŸ‰"
        ];

        const muscleAffirmations = [
            "××—×‘×¨×™× ×—×™×™×©× ×™ EMG ×œ×©×¨×™×¨×™×",
            "××•×“×“×™× ××ª×— ×©×¨×™×¨×™× ××˜×¨××•××•×ª",
            "××–×”×™× ××ª×— ×©× ×©××¨ ××”×™×œ×“×•×ª",
            "××©×—×¨×¨×™× ××ª ×”×›×™×•×•×¥ ××”×¤×—×“",
            "×”××ª×— ××”×¦×¢×§×•×ª ×™×•×¦× ××”×’×•×£",
            "×”×¦×•×•××¨ ×•×”×’×‘ ××©×ª×—×¨×¨×™×",
            "×’×œ×™ ×¨×•×’×¢ ×–×•×¨××™× ×‘×©×¨×™×¨×™×",
            "×”×’×•×£ × ×”×™×” ×¨×š ×•× ×™× ×•×—",
            "×›×œ ×”×©×¨×™×¨×™× ×¨×¤×•×™×™× ×•×¨×›×™×",
            "ğŸ‰ ×”×’×•×£ ×©×œ×š ×—×•×¤×©×™ ××›×œ ××ª×—! ğŸ‰"
        ];

        const skinAffirmations = [
            "××—×‘×¨×™× ×—×™×™×©× ×™ ×ª×’×•×‘×ª ×¢×•×¨",
            "××•×“×“×™× ×¨××ª ××ª×— ××˜×¨××•××•×ª",
            "××–×”×™× ×ª×’×•×‘×ª ×¤×—×“ ××”×™×œ×“×•×ª",
            "××ª×—×™×œ×™× ×œ×”×¨×’×™×¢ ××ª ××¢×¨×›×ª ×”×¢×¦×‘×™×",
            "×”×¢×•×¨ × ×¨×’×¢ ××”×¤×—×“ ×”×™×©×Ÿ",
            "××¢×¨×›×ª ×”×¢×¦×‘×™× × ×›× ×¡×ª ×œ××¦×‘ ×¨×’×•×¢",
            "×ª×’×•×‘×ª ×”×™×œ×—×-××•-×‘×¨×— × ×¨×’×¢×ª",
            "×©×œ×•×•×” ×¢××•×§×” ××—×œ×™×¤×” ××ª ×”××ª×—",
            "××¢×¨×›×ª ×”×¢×¦×‘×™× ×××•×–× ×ª ×œ×—×œ×•×˜×™×Ÿ",
            "ğŸ‰ ××ª ×‘××¦×‘ ×©×œ ×©×œ×•×•×” ×¢××•×§×”! ğŸ‰"
        ];

        const container = document.getElementById('canvasContainer');
        const svg = document.getElementById('simulationCanvas');
        const containerRect = () => container.getBoundingClientRect();

        document.getElementById('fileInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    uploadedImage = e.target.result;
                    document.getElementById('uploadArea').innerHTML = `
                        <div class="upload-icon">âœ…</div>
                        <p class="upload-text">×ª××•× ×” ×”×•×¢×œ×ª×” ×‘×”×¦×œ×—×”!</p>
                    `;
                    document.getElementById('uploadArea').classList.add('has-image');
                    document.getElementById('heartBtn').disabled = false;
                    document.getElementById('breathBtn').disabled = false;
                    document.getElementById('muscleBtn').disabled = false;
                    document.getElementById('skinBtn').disabled = false;
                };
                reader.readAsDataURL(file);
            }
        });

        function makeDraggable(element, onDrag) {
            let isDragging = false;
            let startX, startY, initialX, initialY;

            element.addEventListener('mousedown', (e) => {
                if (isSimulating) return;
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                initialX = element.offsetLeft;
                initialY = element.offsetTop;
                element.style.zIndex = 100;
                e.preventDefault();
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                element.style.left = (initialX + dx) + 'px';
                element.style.top = (initialY + dy) + 'px';
                if (onDrag) onDrag();
            });

            document.addEventListener('mouseup', () => {
                if (isDragging) {
                    isDragging = false;
                    element.style.zIndex = '';
                }
            });

            element.addEventListener('touchstart', (e) => {
                if (isSimulating) return;
                isDragging = true;
                const touch = e.touches[0];
                startX = touch.clientX;
                startY = touch.clientY;
                initialX = element.offsetLeft;
                initialY = element.offsetTop;
                element.style.zIndex = 100;
                e.preventDefault();
            }, { passive: false });

            document.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                const touch = e.touches[0];
                const dx = touch.clientX - startX;
                const dy = touch.clientY - startY;
                element.style.left = (initialX + dx) + 'px';
                element.style.top = (initialY + dy) + 'px';
                if (onDrag) onDrag();
            }, { passive: false });

            document.addEventListener('touchend', () => {
                if (isDragging) {
                    isDragging = false;
                    element.style.zIndex = '';
                }
            });
        }

        function createSensor(x, y, id, type) {
            const handle = document.createElement('div');
            handle.className = `sensor-handle ${type}`;
            handle.id = id;
            handle.style.left = (x - 15) + 'px';
            handle.style.top = (y - 15) + 'px';
            container.appendChild(handle);

            let isDragging = false;

            handle.addEventListener('mousedown', (e) => {
                if (isSimulating) return;
                isDragging = true;
                handle.classList.add('dragging');
                activeHandle = handle;
                e.stopPropagation();
                e.preventDefault();
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging || activeHandle !== handle) return;
                const rect = containerRect();
                const x = e.clientX - rect.left - 19;
                const y = e.clientY - rect.top - 19;
                handle.style.left = Math.max(0, Math.min(rect.width - 38, x)) + 'px';
                handle.style.top = Math.max(0, Math.min(rect.height - 38, y)) + 'px';
                updateWires();
            });

            document.addEventListener('mouseup', () => {
                if (isDragging && activeHandle === handle) {
                    isDragging = false;
                    handle.classList.remove('dragging');
                    activeHandle = null;
                }
            });

            handle.addEventListener('touchstart', (e) => {
                if (isSimulating) return;
                isDragging = true;
                handle.classList.add('dragging');
                activeHandle = handle;
                e.stopPropagation();
                e.preventDefault();
            }, { passive: false });

            document.addEventListener('touchmove', (e) => {
                if (!isDragging || activeHandle !== handle) return;
                const touch = e.touches[0];
                const rect = containerRect();
                const x = touch.clientX - rect.left - 19;
                const y = touch.clientY - rect.top - 19;
                handle.style.left = Math.max(0, Math.min(rect.width - 38, x)) + 'px';
                handle.style.top = Math.max(0, Math.min(rect.height - 38, y)) + 'px';
                updateWires();
            }, { passive: false });

            document.addEventListener('touchend', () => {
                if (isDragging && activeHandle === handle) {
                    isDragging = false;
                    handle.classList.remove('dragging');
                    activeHandle = null;
                }
            });

            return handle;
        }

        function drawWire(x1, y1, x2, y2, id, color) {
            let path = document.getElementById(id);
            if (!path) {
                path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.id = id;
                path.setAttribute('fill', 'none');
                path.setAttribute('stroke-linecap', 'round');
                svg.appendChild(path);
            }

            const midX = (x1 + x2) / 2;
            const midY = (y1 + y2) / 2;
            const dist = Math.sqrt(Math.pow(x2-x1, 2) + Math.pow(y2-y1, 2));
            const curve = dist * 0.25;

            const d = `M ${x1} ${y1} Q ${midX} ${midY - curve} ${x2} ${y2}`;
            path.setAttribute('d', d);
            path.setAttribute('stroke', color);
            path.setAttribute('stroke-width', '6');

            let highlight = document.getElementById(id + '-hl');
            if (!highlight) {
                highlight = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                highlight.id = id + '-hl';
                highlight.setAttribute('fill', 'none');
                highlight.setAttribute('stroke-linecap', 'round');
                svg.appendChild(highlight);
            }
            highlight.setAttribute('d', d);
            highlight.setAttribute('stroke', 'rgba(255,255,255,0.3)');
            highlight.setAttribute('stroke-width', '2');
        }

        function updateWires() {
            wires.forEach(wire => {
                const h1 = document.getElementById(wire.handle1);
                const h2 = document.getElementById(wire.handle2);
                if (h1 && h2) {
                    const x1 = h1.offsetLeft + 19;
                    const y1 = h1.offsetTop + 19;
                    const x2 = h2.offsetLeft + 19;
                    const y2 = h2.offsetTop + 19;
                    drawWire(x1, y1, x2, y2, wire.id, wire.color);
                }
            });
        }

        function clearSensorsAndWires() {
            document.querySelectorAll('.sensor-handle').forEach(h => h.remove());
            svg.innerHTML = '';
            wires = [];
        }

        function setupMode(mode) {
            clearSensorsAndWires();
            currentMode = mode;

            const isMobile = window.innerWidth <= 768;
            const isSmall = window.innerWidth <= 480;

            const userImg = document.getElementById('userImage');
            userImg.classList.remove('hidden');
            userImg.src = uploadedImage;
            userImg.style.left = isSmall ? '220px' : (isMobile ? '320px' : '580px');
            userImg.style.top = isSmall ? '130px' : (isMobile ? '160px' : '180px');

            const bioMonitor = document.getElementById('bioMonitor');
            bioMonitor.classList.remove('hidden');
            bioMonitor.style.left = isSmall ? '5px' : (isMobile ? '15px' : '30px');
            bioMonitor.style.top = isSmall ? '10px' : (isMobile ? '20px' : '30px');

            const releaseContainer = document.getElementById('releaseContainer');
            releaseContainer.classList.remove('hidden');
            releaseContainer.style.left = isSmall ? '5px' : (isMobile ? '15px' : '40px');
            releaseContainer.style.top = isSmall ? '320px' : (isMobile ? '380px' : '380px');

            const calmInfusion = document.getElementById('calmInfusion');
            calmInfusion.classList.remove('hidden');
            calmInfusion.style.left = isSmall ? '110px' : (isMobile ? '160px' : '200px');
            calmInfusion.style.top = isSmall ? '310px' : (isMobile ? '360px' : '350px');

            // Set release level class
            const releaseLevel = document.getElementById('releaseLevel');
            releaseLevel.className = 'release-level';
            if (mode === 'heart') releaseLevel.classList.add('stress');
            else if (mode === 'breath' || mode === 'skin') releaseLevel.classList.add('anxiety');
            else releaseLevel.classList.add('tension');

            makeDraggable(userImg, updateWires);
            makeDraggable(bioMonitor, updateWires);
            makeDraggable(releaseContainer, updateWires);
            makeDraggable(calmInfusion, updateWires);

            const monitorX = isSmall ? 80 : (isMobile ? 100 : 130);
            const bodyX = isSmall ? 240 : (isMobile ? 340 : 610);
            const bodyTopY = isSmall ? 140 : (isMobile ? 180 : 200);
            const bodyMidY = isSmall ? 200 : (isMobile ? 250 : 280);
            const bodyLowY = isSmall ? 260 : (isMobile ? 320 : 360);
            const containerX = isSmall ? 55 : (isMobile ? 65 : 90);
            const containerY = isSmall ? 340 : (isMobile ? 400 : 410);
            const calmX = isSmall ? 150 : (isMobile ? 200 : 250);
            const calmY = isSmall ? 330 : (isMobile ? 380 : 380);

            const sensorType = mode + '-sensor';

            // Monitor to body sensors
            createSensor(monitorX, 60, 's1a', sensorType);
            createSensor(bodyX, bodyTopY - 20, 's1b', sensorType);
            wires.push({ id: 'w1', handle1: 's1a', handle2: 's1b', color: getSensorColor(mode) });

            createSensor(monitorX + 40, 80, 's2a', sensorType);
            createSensor(bodyX + 30, bodyTopY + 20, 's2b', sensorType);
            wires.push({ id: 'w2', handle1: 's2a', handle2: 's2b', color: getSensorColor(mode) });

            createSensor(monitorX + 80, 70, 's3a', sensorType);
            createSensor(bodyX - 20, bodyMidY, 's3b', sensorType);
            wires.push({ id: 'w3', handle1: 's3a', handle2: 's3b', color: getSensorColor(mode) });

            createSensor(monitorX + 60, 100, 's4a', sensorType);
            createSensor(bodyX + 20, bodyMidY + 30, 's4b', sensorType);
            wires.push({ id: 'w4', handle1: 's4a', handle2: 's4b', color: getSensorColor(mode) });

            // Body to release container
            createSensor(bodyX - 30, bodyLowY, 's5a', 'release-sensor');
            createSensor(containerX + 30, containerY - 20, 's5b', 'release-sensor');
            wires.push({ id: 'w5', handle1: 's5a', handle2: 's5b', color: '#78909c' });

            createSensor(bodyX + 40, bodyLowY + 20, 's6a', 'release-sensor');
            createSensor(containerX + 50, containerY + 10, 's6b', 'release-sensor');
            wires.push({ id: 'w6', handle1: 's6a', handle2: 's6b', color: '#607d8b' });

            // Calm infusion to body
            createSensor(calmX, calmY - 10, 's7a', 'calm-sensor');
            createSensor(bodyX, bodyMidY - 20, 's7b', 'calm-sensor');
            wires.push({ id: 'w7', handle1: 's7a', handle2: 's7b', color: '#4db6ac' });

            createSensor(calmX + 30, calmY + 20, 's8a', 'calm-sensor');
            createSensor(bodyX - 10, bodyTopY + 40, 's8b', 'calm-sensor');
            wires.push({ id: 'w8', handle1: 's8a', handle2: 's8b', color: '#26a69a' });

            updateWires();

            document.getElementById('startBtn').style.display = 'flex';
            document.getElementById('progressSection').classList.remove('hidden');
            document.getElementById('affirmation').classList.remove('hidden');
            document.getElementById('resetBtn').classList.remove('hidden');

            const indicator = document.getElementById('modeIndicator');
            indicator.classList.remove('hidden', 'heart', 'breath', 'muscle', 'skin');
            indicator.classList.add(mode);

            const progressFill = document.getElementById('progressFill');
            progressFill.classList.remove('heart', 'breath', 'muscle', 'skin');
            progressFill.classList.add(mode);

            const affirmations = getAffirmations(mode);
            document.getElementById('affirmation').textContent = affirmations[0];

            if (mode === 'heart') {
                indicator.textContent = 'â¤ï¸ ××¦×‘ ××™×–×•×Ÿ ×§×¦×‘ ×”×œ×‘';
            } else if (mode === 'breath') {
                indicator.textContent = 'ğŸŒ¬ï¸ ××¦×‘ ×•×™×¡×•×ª × ×©×™××”';
            } else if (mode === 'muscle') {
                indicator.textContent = 'ğŸ’ª ××¦×‘ ×©×—×¨×•×¨ ××ª×— ×©×¨×™×¨×™×';
            } else {
                indicator.textContent = 'âœ‹ ××¦×‘ ×ª×’×•×‘×ª ×¢×•×¨ ×•×¨×’×™×¢×”';
            }
        }

        function getSensorColor(mode) {
            switch(mode) {
                case 'heart': return '#ff5252';
                case 'breath': return '#26a69a';
                case 'muscle': return '#ff9800';
                case 'skin': return '#5c6bc0';
                default: return '#78909c';
            }
        }

        function getAffirmations(mode) {
            switch(mode) {
                case 'heart': return heartAffirmations;
                case 'breath': return breathAffirmations;
                case 'muscle': return muscleAffirmations;
                case 'skin': return skinAffirmations;
                default: return heartAffirmations;
            }
        }

        function startHeartMode() { if (uploadedImage) setupMode('heart'); }
        function startBreathMode() { if (uploadedImage) setupMode('breath'); }
        function startMuscleMode() { if (uploadedImage) setupMode('muscle'); }
        function startSkinMode() { if (uploadedImage) setupMode('skin'); }

        function startSimulation() {
            if (isSimulating) return;
            isSimulating = true;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('startBtn').textContent = 'â³ ××¢×‘×“...';
            runSimulation();
        }

        function runSimulation() {
            let progress = 0;
            const progressFill = document.getElementById('progressFill');
            const affirmationEl = document.getElementById('affirmation');
            const releaseLevel = document.getElementById('releaseLevel');
            const userImage = document.getElementById('userImage');
            const affirmations = getAffirmations(currentMode);

            // Update vital readings
            const heartValue = document.getElementById('heartValue');
            const breathValue = document.getElementById('breathValue');
            const muscleValue = document.getElementById('muscleValue');
            const skinValue = document.getElementById('skinValue');

            animationInterval = setInterval(() => createParticle(), 120);

            const progressInterval = setInterval(() => {
                progress += 1;
                progressFill.style.width = progress + '%';
                progressFill.textContent = progress + '%';

                if (progress % 10 === 0 && progress <= 100) {
                    const index = Math.min(Math.floor(progress / 10), affirmations.length - 1);
                    affirmationEl.textContent = affirmations[index];
                }

                // Fill release container
                releaseLevel.style.height = progress + '%';

                // Update readings based on mode
                if (currentMode === 'heart') {
                    const newHeart = Math.max(60, 95 - Math.floor(progress * 0.35));
                    heartValue.textContent = newHeart;
                } else if (currentMode === 'breath') {
                    const newBreath = Math.max(6, 18 - Math.floor(progress * 0.12));
                    breathValue.textContent = newBreath;
                } else if (currentMode === 'muscle') {
                    const newMuscle = Math.max(5, 85 - Math.floor(progress * 0.8));
                    muscleValue.textContent = newMuscle + '%';
                } else {
                    const newSkin = Math.max(1.0, 5.5 - (progress * 0.045)).toFixed(1);
                    skinValue.textContent = newSkin;
                }

                // Visual transformation
                userImage.style.filter = `brightness(${100 + progress * 0.25}%) saturate(${100 + progress * 0.15}%)`;
                if (progress > 50) {
                    userImage.style.boxShadow = `0 0 ${progress / 2}px rgba(77, 182, 172, 0.5)`;
                }

                if (progress >= 100) {
                    clearInterval(progressInterval);
                    clearInterval(animationInterval);

                    affirmationEl.textContent = affirmations[affirmations.length - 1];
                    userImage.style.boxShadow = '0 0 50px rgba(77, 182, 172, 0.6)';

                    document.getElementById('saveBtn').disabled = false;
                    document.getElementById('startBtn').textContent = 'âœ… ×”×˜×™×¤×•×œ ×”×•×©×œ×';
                    isSimulating = false;
                }
            }, 600);
        }

        function createParticle() {
            const wireIndex = Math.floor(Math.random() * wires.length);
            const wire = wires[wireIndex];
            const h1 = document.getElementById(wire.handle1);
            const h2 = document.getElementById(wire.handle2);
            if (!h1 || !h2) return;

            const particle = document.createElement('div');
            particle.className = 'particle';

            let color, size;
            if (wire.id.includes('w5') || wire.id.includes('w6')) {
                color = 'radial-gradient(circle, #ffcdd2, #ef5350)';
                size = 10;
            } else if (wire.id.includes('w7') || wire.id.includes('w8')) {
                color = 'radial-gradient(circle, #e0f2f1, #4db6ac)';
                size = 8;
            } else {
                color = `radial-gradient(circle, white, ${wire.color})`;
                size = 8;
            }

            particle.style.cssText = `
                position: absolute;
                width: ${size}px;
                height: ${size}px;
                background: ${color};
                border-radius: 50%;
                z-index: 15;
                pointer-events: none;
                box-shadow: 0 0 8px ${wire.color};
            `;

            const x1 = h1.offsetLeft + 19;
            const y1 = h1.offsetTop + 19;
            const x2 = h2.offsetLeft + 19;
            const y2 = h2.offsetTop + 19;

            particle.style.left = x1 + 'px';
            particle.style.top = y1 + 'px';
            container.appendChild(particle);

            let t = 0;
            const dist = Math.sqrt(Math.pow(x2-x1, 2) + Math.pow(y2-y1, 2));
            const curve = dist * 0.25;

            const moveInterval = setInterval(() => {
                t += 0.04;
                if (t >= 1) {
                    clearInterval(moveInterval);
                    particle.style.opacity = '0';
                    setTimeout(() => particle.remove(), 200);
                    return;
                }

                const midX = (x1 + x2) / 2;
                const midY = (y1 + y2) / 2 - curve;

                const x = (1-t)*(1-t)*x1 + 2*(1-t)*t*midX + t*t*x2;
                const y = (1-t)*(1-t)*y1 + 2*(1-t)*t*midY + t*t*y2;

                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
            }, 20);
        }

        function saveImage() {
            const img = document.getElementById('userImage');
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            const tempImg = new Image();
            tempImg.crossOrigin = 'anonymous';
            tempImg.onload = function() {
                canvas.width = tempImg.width;
                canvas.height = tempImg.height;
                ctx.filter = window.getComputedStyle(img).filter;
                ctx.drawImage(tempImg, 0, 0);
                addToGallery(canvas.toDataURL('image/png'), currentMode);
            };
            tempImg.src = img.src;
        }

        function addToGallery(dataUrl, mode) {
            const gallery = document.getElementById('galleryGrid');
            const galleryTitle = document.getElementById('galleryTitle');

            galleryTitle.classList.remove('hidden');

            const itemId = 'img-' + Date.now();
            const item = document.createElement('div');
            item.className = 'gallery-item';
            item.id = itemId;

            const modeText = mode === 'heart' ? 'â¤ï¸ ××™×–×•×Ÿ ×œ×‘' :
                           mode === 'breath' ? 'ğŸŒ¬ï¸ ×•×™×¡×•×ª × ×©×™××”' :
                           mode === 'muscle' ? 'ğŸ’ª ×©×—×¨×•×¨ ××ª×—' : 'âœ‹ ×¨×’×™×¢×ª ×¢×•×¨';
            const time = new Date().toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' });

            item.innerHTML = `
                <img src="${dataUrl}" alt="×ª××•× ×” ×××•×–× ×ª">
                <button class="delete-btn" onclick="deleteFromGallery('${itemId}')">âœ•</button>
                <div class="gallery-item-info">${modeText} | ${time}</div>
            `;

            item.querySelector('img').addEventListener('click', () => {
                const link = document.createElement('a');
                link.download = `balanced-${mode}-${Date.now()}.png`;
                link.href = dataUrl;
                link.click();
            });
            item.querySelector('img').style.cursor = 'pointer';
            item.querySelector('img').title = '×œ×—×¦×™ ×œ×”×•×¨×“×”';

            gallery.appendChild(item);
        }

        function deleteFromGallery(itemId) {
            const item = document.getElementById(itemId);
            if (item) {
                item.style.transition = 'all 0.3s';
                item.style.transform = 'scale(0)';
                item.style.opacity = '0';
                setTimeout(() => {
                    item.remove();
                    const gallery = document.getElementById('galleryGrid');
                    if (gallery.children.length === 0) {
                        document.getElementById('galleryTitle').classList.add('hidden');
                    }
                }, 300);
            }
        }
    </script>
</body>
</html>
